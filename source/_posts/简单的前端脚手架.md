---
title: ç®€å•çš„å‰ç«¯è„šæ‰‹æ¶
date: 2018-08-31 22:53:34
id: a-simple-cli
categories: ["å‰ç«¯", "JavaScript"]
tags:
  - javascript
  - nodejs
  - cli
keywords:
description:
---

ä»é›¶æ­å»ºä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶å·¥å…·ï¼Œåƒ`vue-cli`ä¸€æ ·ï¼Œä¸€ä¸ªå‘½ä»¤å°±èƒ½å˜å‡ºä¸€ä¸ªå®Œæ•´ç»“æ„çš„åˆå§‹é¡¹ç›®ã€‚æµè¡Œçš„è„šæ‰‹æ¶å·¥å…·æœ‰å¾ˆå¤šå®ç”¨çš„åŠŸèƒ½ï¼Œè¿™é‡Œè¦è¯´çš„æ˜¯æœ€åŸºæœ¬çš„ä¸€é¡¹ï¼šé€šè¿‡ä¸€ä¸ªå‘½ä»¤å¿«é€Ÿåˆ›å»ºå‡ºåˆå§‹é¡¹ç›®ã€‚

<!-- more -->

# ç®€å•çš„æ€è·¯

1. å€ŸåŠ© nodejs å®ç°å‘½ä»¤è¡Œçš„äº¤äº’ï¼Œè¯»å–ä½¿ç”¨è€…è¾“å…¥ï¼Œå¯ä»¥åšä¸€äº›ç”Ÿæˆé¡¹ç›®æ—¶çš„é…ç½®ï¼›
2. å¤åˆ¶é¢„è®¾çš„æ¨¡æ¿æ–‡ä»¶ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥åšå‡ºä¸€äº›é…ç½®ï¼Œæœ€åç²˜è´´åˆ°æŒ‡å®šä½ç½®ã€‚

# åˆå§‹åŒ–é¡¹ç›®

åˆ›å»ºç©ºç›®å½•`simple-cli`å¹¶åˆå§‹åŒ–ï¼š

```bash
$ mkdir simple-cli && cd simple-cli && yarn init -y
```

å®‰è£…ç›¸å…³ä¾èµ–ï¼š

1. [commander](https://github.com/tj/commander.js/)ï¼šä¸€ä¸ªå¿«é€Ÿå¼€å‘ nodejs å‘½ä»¤è¡Œå·¥å…·çš„åº“ï¼›
2. [co](https://github.com/tj/co)ï¼šç”¨åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥æµç¨‹çš„ä»£ç ï¼›
3. [co-prompt](https://github.com/tj/co-prompt)ï¼šåœ¨å‘½ä»¤è¡Œæä¾›æç¤ºä¿¡æ¯å¹¶æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼›
4. [copy-template-dir](https://github.com/yoshuawuyts/copy-template-dir)ï¼šå¤åˆ¶æ•´ä¸ªç›®å½•åˆ°æŒ‡å®šè·¯å¾„ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡å˜é‡æ³¨å…¥ä¿¡æ¯ã€‚

åœ¨`simple-cli/`ï¼š

```bash
$ yarn add commander co co-prompt copy-template-dir
```

åœ¨`package.json`ä¸­æ·»åŠ `bin`ï¼š

```js
{
  "name": "simple-cli",
  "version": "1.0.0",
  "license": "MIT",
  "dependencies": {
    "co": "^4.6.0",
    "co-prompt": "^1.0.0",
    "commander": "^2.17.1",
    "copy-template-dir": "^1.4.0"
  },
  "bin": {
    // éœ€è¦ä½œä¸ºå‘½ä»¤è¡Œè°ƒç”¨ï¼Œè¦æ·»åŠ  bin
    "simple-cli": "./index.js"
  }
}

```

åˆ›å»ºç›¸åº”æ–‡ä»¶ï¼Œæœ€åç›®å½•ç»“æ„å¯ä»¥æ˜¯è¿™æ ·çš„ï¼š

```bash
.
â”œâ”€â”€ index.js
â”œâ”€â”€ lib
â”‚   â””â”€â”€ init.js
â”œâ”€â”€ node_modules
â”œâ”€â”€ package.json
â””â”€â”€ yarn.lock
```

# å¼€å‘

## åˆ›å»ºå‘½ä»¤è¡Œå·¥å…·

å¯ä»¥ç›´æ¥ä½¿ç”¨`node ./index.js`è¿›è¡Œè¿è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`yarn link`åç›´æ¥é€šè¿‡`simple-cli`è¿›è¡Œä½¿ç”¨ï¼ˆ`yarn unlink`å¯ä»¥è¿›è¡Œå–æ¶ˆï¼‰ã€‚

`index.js`ï¼š

```js
#!/usr/bin/env node
// å› ä¸ºæ˜¯ä½œä¸ºå‘½ä»¤è¡Œè°ƒç”¨çš„ï¼Œåœ¨ç¬¬ä¸€è¡ŒåŠ ä¸Š #!/usr/bin/env node

"use strict";
const program = require("commander");
const packageJSON = require("./package.json");
const init = require("./lib/cmd/init");

program.version(packageJSON.version).usage("<command> [options]");

program
  .command("init")
  .description("åˆ›å»ºæ–°æ–°é¡¹ç›®")
  .alias("i")
  .action(() => {
    // æ¥æ”¶åˆ° init å‘½ä»¤æ‰§è¡Œ init() æ–¹æ³•
    init();
  });

program.parse(process.argv);

if (program.args.length == 0) {
  // è¿™é‡Œæ˜¯å¤„ç†æ²¡æœ‰è¾“å…¥å‚æ•°å‘½ä»¤çš„æ—¶å€™ï¼Œæ˜¾ç¤º help
  program.help();
}
```

`./lib/init.js`ï¼š

```js
"use strict";

// å¯¼å‡ºä¸€ä¸ªæ–¹æ³•
module.exports = () => {};
```

æ‰§è¡Œ`simple-cli`ï¼š

```bash
$ simple-cli

  Usage: simple-cli <command> [options]

  Options:

    -V, --version  output the version number
    -h, --help     output usage information

  Commands:

    init|i         åˆ›å»ºæ–°æ–°é¡¹ç›®
```

> å¦‚`yarn link`ä¹‹åä½¿ç”¨`simple-cli`æç¤º`permission denied: simple-cli`ï¼Œé‚£ä¹ˆéœ€è¦å¯¹ linked file æ‰§è¡Œ`chmod +x ./index.js`ã€‚

## æ·»åŠ æ¨¡æ¿

æ ¹ç›®å½•æ·»åŠ `templates/templateA/`ï¼Œæœ€ç»ˆçš„ç›®å½•ç»“æ„ï¼š

```bash
.
â”œâ”€â”€ index.js
â”œâ”€â”€ lib
â”‚   â””â”€â”€ init.js
â”œâ”€â”€ node_modules
â”œâ”€â”€ package.json
â”œâ”€â”€ templates
â”‚   â””â”€â”€ templateA
â””â”€â”€ yarn.lock
```

ç®€å•æ·»åŠ ä¸€ä¸ªæ¨¡æ¿`templateA`ï¼š

```bash
.
â”œâ”€â”€ CONTRIBUTING.md
â”œâ”€â”€ README.md
â”œâ”€â”€ _package.json
â”œâ”€â”€ nwb.config.js
â”œâ”€â”€ src
â””â”€â”€ tests

# æ³¨æ„ï¼š
# 1. _package.jsonï¼Œ_ å¼€å¤´çš„æ–‡ä»¶é€šè¿‡ copy-template-dir æ‹·è´åä¼šè‡ªåŠ¨åˆ é™¤ _ã€‚
# 2. æ–‡ä»¶ä¸­ç±»ä¼¼ {{å˜é‡å}} çš„åœ°æ–¹å¯é€šè¿‡ copy-template-dir è‡ªåŠ¨æ³¨å…¥ä¿¡æ¯ã€‚
```

## å®šä¹‰`init.js`

```js
"use strict";

const { exec } = require("child_process");
const co = require("co");
const prompt = require("co-prompt");
const copy = require("copy-template-dir");
const path = require("path");

module.exports = () => {
  co(function*() {
    // å¤„ç†ç”¨æˆ·è¾“å…¥
    const projectName = yield prompt("Project name: ");
    const description = yield prompt("Description: ");

    // æ‰§è¡Œ simple-cli æ—¶æ‰€å¤„çš„è·¯å¾„
    const currentPath = path.resolve(process.cwd(), "./");
    // æ¨¡æ¿è·¯å¾„
    const templateDir = path.resolve(__dirname, "../templates/templateA");
    // è¾“å‡ºè·¯å¾„
    const outDir = path.resolve(currentPath, projectName);
    // ç²˜è´´æ¨¡æ¿æ—¶æ³¨å…¥çš„ä¿¡æ¯
    const values = {
      name: projectName,
      description
    };

    // æ‹·è´æ¨¡æ¿
    copy(path.resolve(templateDir), outDir, values, (err, createdFiles) => {
      if (err) {
        process.exit(1);
      }

      createdFiles.forEach(filePath => console.log(`Created ${filePath}`));

      // nodejs æ‰§è¡Œå‘½ä»¤
      const cmdStr = `cd ${outDir} && yarn`;
      console.log(`now excuting: ${cmdStr}`);
      exec(cmdStr, error => {
        if (error) {
          process.exit(1);
        }

        console.log("\n âˆš Generation completed!");
        process.exit(0);
      });
    });
  });
};
```

# ä½¿ç”¨

```bash
$ simple-cli init

Project name: test
Description: some description
Created /Users/daief/Desktop/test/.travis.yml
Created /Users/daief/Desktop/test/README.md
Created /Users/daief/Desktop/test/CONTRIBUTING.md
Created /Users/daief/Desktop/test/package.json
Created /Users/daief/Desktop/test/nwb.config.js
Created /Users/daief/Desktop/test/tests/.eslintrc
Created /Users/daief/Desktop/test/tests/App-test.js
Created /Users/daief/Desktop/test/src/App.css
Created /Users/daief/Desktop/test/src/App.js
Created /Users/daief/Desktop/test/src/index.css
Created /Users/daief/Desktop/test/src/index.html
Created /Users/daief/Desktop/test/src/index.js
Created /Users/daief/Desktop/test/src/react.svg
now excuting: cd /Users/daief/Desktop/test && yarn

 âˆš Generation completed!
```

# ç»“æŸ

ä¸€ä¸ªç‚’é¸¡ç®€å•çš„è„šæ‰‹æ¶å°±å®Œæˆäº†ï¼Œè¿˜åŒæ—¶äº†è§£äº†å¦‚ä½•é€šè¿‡ nodejs æ„å»ºä¸€ä¸ªäº¤äº’å¼çš„å‘½ä»¤è¡Œå·¥å…·ã€‚

å¦ï¼Œè¿˜å¯ä»¥æ·»åŠ [chalk](https://github.com/chalk/chalk)æ¥ç¾åŒ–å‘½ä»¤è¡Œçš„è¾“å‡ºï¼Œåˆæˆ–æ˜¯å‘å¸ƒåˆ° npm åˆ†äº«ç»™å°ä¼™ä¼´ä½¿ç”¨ã€‚

é¡¹ç›®åœ°å€ï¼š[https://github.com/daief/simple-cli](https://github.com/daief/simple-cli)ã€‚

Thanks. ğŸ˜ƒ
