---
title: å‡½æ•°æå‡ & æœ‰æ¡ä»¶åœ°åˆ›å»ºå‡½æ•°
date: 2020-03-08 15:54:52
id: function-hoist-and-conditionally-created-functions
categories: ['å‰ç«¯', 'JavaScript']
tags:
  - JavaScript
keywords:
  - javascript
  - function hoist
---

æœ¬æ–‡å§‹äºè¿™æ ·ä¸€é“ JavaScript é¢˜ç›®ã€‚

```js
var a;
if (true) {
  a = 5;
  function a() {}
  a = 2;
  console.log(a);
}
console.log(a);
```

<!-- more -->

**è¿™ç§å†™æ³•æ˜¯ååˆ†ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨**ï¼Œè€Œä¸”åœ¨ä¸åŒçš„æµè§ˆå™¨ä¸­ä¼šæœ‰ä¸åŒçš„è¡¨ç°ï¼Œæœ¬æ–‡æ‰€æœ‰ç»“æœéƒ½æ˜¯åœ¨ Chrome 80.0.3987.132 ä¸­è¿è¡Œå¾—åˆ°çš„ã€‚

ä½†ä¸Šè¿°ä»£ç ç‰‡æ®µçš„ç»“æœå´ååˆ†ç¥å¥‡ï¼Œå®ƒçš„è¿è¡Œç»“æœæ˜¯ï¼š

```bash
2
5
```

åœ¨è¯¦ç»†ç ”ç©¶è¿™é“é¢˜ä¹‹å‰ï¼Œå…ˆå›é¡¾ä¸‹ä¸¤é¡¹æ¦‚å¿µã€‚é¡ºä¾¿ä¸€æï¼Œå…¨æ–‡ç»“æŸä¹Ÿç»™ä¸å‡ºä¸€ä¸ªè¿™é“é¢˜çš„â€œä¸ºä»€ä¹ˆâ€ã€‚

## å‡½æ•°å£°æ˜æå‡

ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨ JS å½“ä¸­ï¼Œä»£ç ä¸€çš„å†™æ³•å®é™…ä¸Šå¯ä»¥çœ‹æˆæ˜¯æŒ‰ç…§ä»£ç äºŒçš„æ­¥éª¤æ¥è¿è¡Œçš„ã€‚

ä»£ç ä¸€ï¼š

```js
hoisted(); // "foo"

function hoisted() {
  console.log('foo');
}
```

ä»£ç äºŒï¼š

```js
var hoisted;

hoisted = function() {
  console.log('foo');
};

hoisted(); // "foo"
```

æ ¹æ® MDN çš„æè¿°ï¼Œå‡½æ•°æå‡ï¼š

> Function declarations in JavaScript are hoisted to the top of the enclosing function or global scope.

æŒ‡ JS ä¸­å‡½æ•°çš„å®šä¹‰ä¼šè¢«æå‡åˆ°**æ–¹æ³•ä½œç”¨åŸŸ**æˆ–**å…¨å±€ä½œç”¨åŸŸ**çš„é¡¶éƒ¨ã€‚ä½†å½“åŠ å…¥**å—çº§ä½œç”¨åŸŸ**çš„æ—¶å€™ï¼Œäº‹æƒ…å°±å˜å¾—å¤æ‚äº†èµ·æ¥ã€‚

## æœ‰æ¡ä»¶åœ°åˆ›å»ºå‡½æ•°

æœ¬èŠ‚æ‘˜è‡ª MDNï¼š

```js
var hoisted = 'foo' in this;

console.log(
  `'foo' name ${
    hoisted ? 'is' : 'is not'
  } hoisted. typeof foo is ${typeof foo}`,
);

// åœ¨ Chrome é‡Œ:
// 'foo' å˜é‡åè¢«æå‡ï¼Œä½†æ˜¯ typeof foo ä¸º undefined
//
// åœ¨ Firefox é‡Œ:
// 'foo' å˜é‡åè¢«æå‡. ä½†æ˜¯ typeof foo ä¸º undefined
//
// åœ¨ Edge é‡Œ:
// 'foo' å˜é‡åæœªè¢«æå‡. è€Œä¸” typeof foo ä¸º undefined
//
// åœ¨ Safari é‡Œ:
// 'foo' å˜é‡åè¢«æå‡. è€Œä¸” typeof foo ä¸º function

if (true) {
  function foo() {
    return 1;
  }
}
```

å¯ä»¥çœ‹åˆ° `foo` å˜é‡è¢«æå‡ä¸ºå…¨å±€çš„ `foo`ï¼Œç¬¦åˆå‰æ–‡å˜é‡æå‡çš„æè¿°ï¼Œå§‘ä¸”å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼å»æè¿°è¿™æ®µä»£ç çš„æ‰§è¡Œæ­¥éª¤ï¼š

> æš‚ä¸”åªä»¥ Chrome ä¸­çš„è¿è¡Œæ•ˆæœä¸ºå‡†ï¼Œè€Œå®é™…ä¸Šæˆ‘è®¤ä¸º Safari ä¸­çš„è¡¨ç°æ‰ç¬¦åˆé¢„æœŸä¸­çš„æ•ˆæœã€‚

```js
var foo;

if (true) {
  foo = function() {
    return 1;
  };
}
```

ä½†ç”¨è¿™ç§æ–¹å¼ä»£å…¥å¼€ç¯‡çš„é¢˜ç›®ä¸­æ—¶ï¼Œä¼šå‘ç°å¹¶ä¸æ˜¯è¿™æ ·çš„ã€‚

## è°ƒè¯•é¢˜ç›®

å€ŸåŠ© Chrome DevTools è·Ÿè¸ªä»£ç æ¯ä¸€æ­¥çš„è¿è¡Œï¼Œå½“è¿è¡Œè‡³èŠ±æ‹¬å·`{`æ—¶ï¼Œå‘ç°å¤šäº†ä¸€ä¸ªå—çº§ä½œç”¨åŸŸï¼ŒåŒæ—¶å—çº§ä½œç”¨åŸŸä¸­æœ‰ä¸€ä¸ªå±€éƒ¨å˜é‡ `a`ï¼š

> æœ¬æ–­ä»£ç æŠŠ if çœç•¥äº†ï¼Œæ•ˆæœä¸€æ ·ï¼›åŒæ—¶æ·»åŠ äº†ä¸å°‘ debugger æ–¹ä¾¿æ–­ç‚¹ã€‚

![1](function-hoist-and-conditionally-created-functions/1.jpg)

å¹¶ä¸”å±€éƒ¨ `a` çš„å€¼æ˜¯å—çº§ä½œç”¨åŸŸå†…å®šä¹‰çš„å‡½æ•°ï¼ŒåŒæ—¶å…¨å±€çš„ `window.a` ä¾æ—§æ˜¯ `undefined`ã€‚

> æ­¤æ—¶æˆ‘çš„å†…å¿ƒæƒ³æ³•ï¼šå‡½æ•°ä¸æ˜¯åº”è¯¥è¢«æå‡åˆ°é¡¶çº§ä½œç”¨åŸŸå—ï¼Œä¸ä»…ä¸æ˜¯ï¼Œä»å“ªé‡Œåˆå†’å‡ºäº†ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œé»‘äººé—®å·.jpg

ç»è¿‡ `a = 5` çš„èµ‹å€¼åï¼Œå±€éƒ¨å˜é‡çš„ `a` ä¸º `5`ï¼Œ`window.a` ä¾æ—§æ˜¯ `undefined`ã€‚

![2](function-hoist-and-conditionally-created-functions/2.jpg)

æ‰§è¡Œå®Œ**å‡½æ•°å£°æ˜**è¯­å¥åï¼Œ`window.a` ç¥å¥‡åœ°å˜ä¸ºäº† `5`ã€‚æˆ‘è§‰å¾—æ­¤æ—¶çœ‹åˆ°çš„åªæ˜¯è¡¨é¢ä¸Šçš„ä»£ç äº†ï¼ŒèƒŒåè§£é‡Šå™¨çš„è¿è¡Œä¸€å®šæœ‰å…¶ä»–çš„è¡Œä¸ºï¼Œä½†å¯¹äºè¿™äº›æˆ‘ç°åœ¨è¿˜ä¸å¾—è€ŒçŸ¥ã€‚

![3](function-hoist-and-conditionally-created-functions/3.jpg)

æœ€å `a = 2` çš„èµ‹å€¼ä¹Ÿåªæ˜¯æ”¹å˜äº†å±€éƒ¨å˜é‡ `a`ï¼Œå½“è·³å‡ºå—çº§ä½œç”¨åŸŸåï¼Œåªèƒ½è®¿é—®åˆ° `window.a`ï¼Œæœ€ç»ˆå¾—åˆ°äº†å¼€ç¯‡çš„æè¿°çš„ç»“æœã€‚

![4](function-hoist-and-conditionally-created-functions/4.jpg)

## ç»“è¯­

è¿™ä¸ªäº‹æƒ…æ²¡èƒ½å¾—åˆ°ä¸€ä¸ªæ˜ç¡®çš„è§£é‡Šè¯´æ˜å®é™…ä¸ŠæŒºçƒ¦äººçš„ï¼Œæ„Ÿè§‰è‡ªå·±å­¦çš„çŸ¥è¯†è¢«â€œä¾®è¾±â€äº† ğŸ˜†ï¼Œç›®å‰åªèƒ½åº†å¹¸è¿™æ˜¯ä¸€ç§è¢«æåŠ›åå¯¹çš„å†™æ³•ï¼Œç°å®å½“ä¸­å¹¶ä¸ä¼šé‡åˆ°ã€‚

è¦æ˜¯æœ‰å¤§ä½¬èƒ½ç°èº«å¸®å¿™ç‚¹æ‹¨ä¸€ç•ªï¼Œä¸èƒœæ„Ÿæ¿€ï¼

è¿˜æœ‰å…³äºæœ‰æ¡ä»¶åœ°åˆ›å»ºå‡½æ•°ï¼Œæˆ‘æƒ³çœŸä¸ä¼šæœ‰äººåƒè¿™æ ·ç¼–ç å§ï¼š

```js
// âŒ
if (condition) {
  function foo() {
    return 'true';
  }
} else {
  function foo() {
    return 'false';
  }
}

foo();
```

ä¸€èˆ¬è€Œè¨€ï¼Œåº”è¯¥æ˜¯è¿™æ ·æ¯”è¾ƒå¤šæ‰å¯¹ï¼š

```js
function foo() {
  return !!condition + '';
}

foo();
```

æˆ–è€…ï¼ŒçœŸæƒ³è¿›è¡Œ**æœ‰æ¡ä»¶åœ°åˆ›å»ºå‡½æ•°**ï¼Œä¹Ÿå»ºè®®ä½¿ç”¨ä¸ä¼šæœ‰æå‡ç°è±¡çš„å‡½æ•°è¡¨è¾¾å¼ï¼š

```js
var foo;

// if è¯­å¥æˆ–è€…ä¸‰å…ƒè¡¨è¾¾å¼
if (condition) {
  foo = function() {
    return 'true';
  };
} else {
  foo = function() {
    return 'false';
  };
}

foo();
```

æœ€åï¼Œç¥å…¨å¤©ä¸‹çš„å¥³ç¥èŠ‚æ—¥å¿«ä¹å“¦~

å®Œã€‚

---

å‚è€ƒèµ„æ–™ï¼š

- [Hoistingï¼ˆå˜é‡æå‡](https://developer.mozilla.org/zh-CN/docs/Glossary/Hoisting)
- [function declaration](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)
