<template>
  <div class="relative">
    <article>
      <header>
        <h1 class="text-foreground text-3xl font-bold mb-4">
          <%- article.frontmatter.title %>
        </h1>

        <PostMetaInfo :meta="meta" />
      </header>
      <Markdown class="mt-6">
        <%- article.excerpt %>
        <a href="#more" class="hidden"></a>
        <%- article.more %>
      </Markdown>
    </article>
    <aside
      v-if="toc.length"
      class="absolute left-[calc(100%+60px)] top-0 h-full"
    >
      <div
        class="w-50 sticky top-10 overflow-y-auto"
        style="max-height: calc(100vh - 120px)"
      >
        <nav class="text-foreground">
          <Toc :toc="toc" />
        </nav>
      </div>
    </aside>
  </div>

  <hr class="border-border mt-10" />

  <div class="mt-10" v-if="meta.comments">
    <Comment />
  </div>
</template>

<script setup lang="jsx">
  import { defineComponent } from 'vue';
  import Markdown from '@app/components/markdown.vue';
  import PostMetaInfo from '@app/components/post/meta-info.vue';
  import ALink from '@app/components/a-link.vue';
  import { usePageTitle } from '@app/composables/use-page-title';
  import Comment from '@app/components/comment.vue';
  import Toc from '@app/components/toc.vue';

  defineOptions({
    name: 'Article',
  });

  usePageTitle({
    title: `<%- article.frontmatter.title %>`,
    description: `<%- article.frontmatter.description || '' %>`,
  });

  const meta = JSON.parse('<%- JSON.stringify({ ...article.frontmatter }) %>');
  const toc = JSON.parse('<%- JSON.stringify(article.toc) %>');
</script>
